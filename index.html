<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NTMC | Scanpedia</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rowdies:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css?ver=12">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" />
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.0/dist/mindar-image-aframe.prod.js"></script>
    <script src="js/aframe-extras.js"></script>
    <script src="js/aframe-text-geometry-component.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script data-n-head="1" src="https://staging.api.scanpedia.id/marker/primeskills.analitycs.js" mode="client" async="" data-body="true" defer=""></script>
    
    <!-- Google Analytics for Production -->
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N708BP5PEV"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-N708BP5PEV');
    </script>



</head>
<body>
    <div id="app" class="app" v-cloak>
        <!-- Audio Source Asset -->
        <audio id="audio-hi" src="Asset/ntmc/NTMC-AR_male_sound/mndr1-male-03-oh.mp3"></audio>
        <audio id="audio-no" src="Asset/ntmc/NTMC-AR_male_sound/mndr1-male-05-sigh.mp3"></audio>
        <audio id="audio-yes" src="Asset/ntmc/NTMC-AR_male_sound/mndr1-male-01-excited_yes.mp3"></audio>
        
        <!-- Intro Page -->
        <div class="intro-page" id="intro-page" v-show="intropage">
            <div class="markonah-logo">
                <!-- <img src="Asset/ntmc/NTMC-POLRI.png" alt="" width="210px"> -->
                <div class="intro-page-title">Virtual Edukasi</div>
                <div class="intro-page-title">Disiplin Tertib Berlalu Lintas</div>
            </div>
            <div class="scanpedia-logo">
                <img src="Asset/ntmc/LOGO-NTMC-FINAL.png" alt="" width="244px">
            </div>
            <div class="scanpedia-logo">
                <img src="Asset/ntmc/Powered By Scanpedia.png" alt="" width="180px">
            </div>
            <div class="intro-text">
                <p>Rasakan Pengalaman AR seru dari kami</p>
            </div>
            <button class="try-now-btn" @click="tryNowClick()">Play Now</button>
        </div>

        <!-- Registration Page -->
        <div class="registration-page" id="registration-page" v-show="registpage">
            <div class="registration-form">
                <div class="form">
                    <form v-on:submit.prevent="submitSignUp">
                        <label for="regist-phone">Phone</label>
                        <input v-model="userphonenumber" type="tel" id="regist-phone" name="regist-phone" placeholder="Example : 0853xxxxxxxx" required><br>
                        <label for="first-name">First Name</label>
                        <input v-model="userfirstname" type="text" id="first-name" name="first-name" placeholder="Example : Lionel" required><br>
                        <label for="last-name">Last Name</label>
                        <input v-model="userlastname" type="text" id="last-name" name="last-name" placeholder="Example : Messi" required>
                        <button type="submit" class="sign-up-btn">Sign Up</button>
                    </form>
                </div>
            </div>
        </div>

        

        <!-- AR Introduction  -->
        <div class="ar-intro-page" id="ar-intro-page" v-show="arintropage">
            <img class="ar-bubble" src="Asset/ntmc/bubble-intro.png" alt="" width="280px">
            <button v-show="rearcamerabtnvisible" class="rear-camera-btn" @click="activateRearCameraClick()">Activate Rear Camera</button>
            <img class="marko3" src="Asset/ntmc/mascot/police_idle2 1.png" alt="Marko 3" width="300px">
            <p v-show="!rearcamerabtnvisible" class="loading-camera">Menunggu Kamera ....</p>
        </div>

        <!-- AR Experience -->
        <div class="ar-experience" id="ar-experience" v-show="arexperience">
            <!-- Testing GIF -->
            <div class="marko-gif">
                <img src="Asset/ntmc/png/char2_Polisi_Idle_Full.png" alt="Police Idle" width="300px" v-show="isIdleMarko">
                <img src="Asset/ntmc/png/char3_Polisi_Yes_full.png" alt="Police Right" width="300px" v-show="isRightMarko">
                <img src="Asset/ntmc/png/char4_Polisi_No_full.png" alt="Police Wrong" width="300px" v-show="isWrongMarko">
            </div>

            <div class="ar-guidance" v-show="!targetfound && !markoclickme">
                <p>Point your camera to</p>
                <p>AR Marker</p>
                <img src="Asset/ntmc/point-ar-gif.gif" alt="marko GIF" width="104px">
            </div>
            <div id="guide" v-show="!targetfound && !markoclickme">
                <div class="hole"></div>
                <div>
                    <img src="Asset/arexperience/scanner-border-goodres.png" class="scanner-border">
                </div>
            </div>
            <div class="ar-overlay" v-show="!targetfound && !markoclickme">
                <div class="overlay"></div>
            </div>

            <!-- After target has been found -->
            <div class="ar-start-quiz" v-show="arstartquiz" @click="clickMeStartTheQuiz()">
                <!-- <img class="marko3" src="Asset/arintro/marko3-goodres.png" alt="Marko 3" width="170px"> -->
                <img class="marko3-clickme" alt="" src="Asset/ntmc/clickme.png" width="298px">
            </div>

            <!-- Loading Question -->
            <div class="loading" v-if="loading">Memuat....</div>
            <!-- Quiz Time !!! -->
            <div class="quiz-container" v-show="markoclickme && isLoadQuestion" >
                <div class="question-number">{{ currentQuestion + 1 }} of {{questions.length == undefined ? 0 : questions.length}}</div>
                <div class="question">{{ question == undefined ? "" : question }}</div>
                <img src="Asset/ntmc/LOGO-NTMC-FINAL.png" alt="Logo NTMC" width="78px">
                <div class="btn-grid">
                  <!-- <a class="box box1">Semarang kan ada gudeg</a>
                  <a class="box box1">Solo kan ada selat</a>
                  <a class="box box1">Salatiga</a>
                  <a class="box box1">Surabaya</a> -->
                  <a class="box box1" v-for="(answer, i) in answers" :key="answer.option_key" @click="checkAnswer(answer)" :class="answerClass(answer)">{{ answer.option }}</a>
                </div>
                <h1 :class="{benardialog: iscorrect, salahdialog: !iscorrect}" v-show="isanswered">{{ correctorincorrect }}</h1>
                <button @click="nextQuestion()" :class="{questionnext: isanswered, questionnextdisabled: !isanswered}">Next</button>

            </div>


            <!-- Score -->
            <div class="quiz-score" v-show="markoclickme && isLoadQuestion">
                <img src="Asset/quiz/bi_coin-goodres.png" alt="" width="24px">
                <p>{{ totalcoins }}</p>
            </div>


            <!-- AR TIME !!! -->
            <a-scene mindar-image="filterMinCF:0.0001; filterBeta: 0.001; imageTargetSrc: image/targets4.mind; autoStart: false; uiScanning: #guide;"
            color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false"
            device-orientation-permission-ui="enabled: false" loading-screen="dotsColor: red; backgroundColor: black">

            <!-- Video ASSETS -->
            <a-assets>
                <a-asset-item id="ntmc-police" src="Asset/ntmc/glb/Stylized_Polantas_Man.glb"></a-asset-item>
            </a-assets>
            


            <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

            <a-entity id="target-markonah-1" mindar-image-target="targetIndex: 0">
              <a-gltf-model id="ntmc-1" rotation="0 0 0 " position="0 -1 0" scale="0.8 0.8 0.8" src="#ntmc-police"
              animation-mixer="clip: NlaTrack*"></a-gltf-model>
            </a-entity>
            <a-entity id="target-markonah-2" mindar-image-target="targetIndex: 1">
                <a-gltf-model id="ntmc-2" rotation="0 0 0 " position="0 -1 0" scale="0.8 0.8 0.8" src="#ntmc-police"
              animation-mixer="clip: NlaTrack*"></a-gltf-model>
            </a-entity>
            <a-entity id="target-markonah-3" mindar-image-target="targetIndex: 2">
                <a-gltf-model id="ntmc-3" rotation="0 0 0 " position="0 -1 0" scale="0.8 0.8 0.8" src="#ntmc-police"
                animation-mixer="clip: NlaTrack*"></a-gltf-model>
            </a-entity>
            <a-entity id="target-markonah-4" mindar-image-target="targetIndex: 3">
                <a-gltf-model id="ntmc-4" rotation="0 0 0 " position="0 -1 0" scale="0.8 0.8 0.8" src="#ntmc-police"
                animation-mixer="clip: NlaTrack*"></a-gltf-model>
            </a-entity>
            <a-entity id="target-markonah-5" mindar-image-target="targetIndex: 4">
                <a-gltf-model id="ntmc-5" rotation="0 0 0 " position="0 -1 0" scale="0.8 0.8 0.8" src="#ntmc-police"
              animation-mixer="clip: NlaTrack*"></a-gltf-model>
            </a-entity>

            </a-scene>
        </div>

        <!-- Result Page BERHASIL -->
        <div class="result-page" id="result-page" v-show="resultpagesuccess">
            <img class="confeti" src="Asset/gif/confeti.gif" alt="">
            <div class="markonah-logo">
                <img src="Asset/ntmc/LOGO-NTMC-FINAL.png" alt="" width="60px">
            </div>

            <div class="quiz-congratulations">
                <p>Terima kasih telah mengikuti kuis dari kami</p>
                <h5>Skor Anda</h5>
                <div class="result-score">
                    <!-- <img src="Asset/quiz/bi_coin-goodres.png" alt="" width="24px"> -->
                    <div class="score">{{ totalcoins }}</div>
                </div>
            </div>

            <div class="claim-rewards">
                <!-- <div class="claim-rewards-message">Good Job! Selamat, Anda berhasil menyelesaikan tantangan dengan baik. Terus jaga kerja baik Anda !</div> -->
                <img class="marko3" src="Asset/ntmc/mascot/police_yes3 1.png" alt="Marko 3" width="350px">
            </div>

            <!-- <button class="claim-rewards-btn" @click="claimRewardsClick()">Claim Rewards</button> -->
            <button class="claim-rewards-btn" @click="backToHomeClick()">Try Again</button>

            <!-- Star Rating -->
            <div class="result-rating" v-show="resultpagesuccess && !closeresultrating">
                <a href="#" class="close-btn" @click="closeRatingButtonClick()"><img src="Asset/result/close-button.png" alt="Close Button" width="24px"></a>
                <!-- <div class="result-rating-message">How would you rate your experience with our company?</div> -->
                <div class="result-rating-message">Bagaimana pengalaman Anda bermain bersama kami?</div>
                <div class="stars">
                    <!-- <i class="fa-solid fa-star"></i>
                    <i class="fa-solid fa-star"></i>
                    <i class="fa-solid fa-star"></i>
                    <i class="fa-solid fa-star"></i>
                    <i class="fa-solid fa-star"></i> -->
                    <i v-for="(star,index) in stars" :key="index" 
                    @click="rate(index+1)"
                    :class="{active: index < selectedRating}"
                    class="fa-solid fa-star"></i>
                </div>
                <p class="star-message">{{ getMessage(selectedRating) }}</p>
                <button class="submit-btn" :class="{disabled : !selectedRating}" @click="submitRating()"></button>
            </div>
        </div>

        <!-- Result Page GAGAL! -->
        <div class="result-page" id="result-page" v-show="resultpagefailed">
            <!-- <img class="confeti" src="Asset/gif/confeti.gif" alt=""> -->
            <div class="markonah-logo">
                <img src="Asset/ntmc/LOGO-NTMC-FINAL.png" alt="" width="60px">
            </div>

            <div class="quiz-congratulations">
                <p>Terima kasih telah mengikuti kuis dari kami</p>
                <h5>Skor Anda</h5>
                <div class="result-score">
                    <!-- <img src="Asset/quiz/bi_coin-goodres.png" alt="" width="24px"> -->
                    <div class="score">{{ totalcoins }}</div>
                </div>
            </div>

            <div class="try-again">
                <!-- <div class="try-again-message">Great Effort! Kesuksesan adalah hal yang perlu di perjuangkan. Coba lagi ya! Semangat!</div> -->
                <img class="marko3" src="Asset/ntmc/mascot/police_yes3 1.png" alt="Marko 3" width="350px">
            </div>

            <button @click="windowsReload()" class="try-again-btn">Try Again</button>

            <!-- Star Rating -->
            <div class="result-rating" v-show="resultpagefailed && !closeresultrating">
                <a href="#" class="close-btn" @click="closeRatingButtonClick()"><img src="Asset/result/close-button.png" alt="Close Button" width="24px"></a>
                <!-- <div class="result-rating-message">How would you rate your experience with our company?</div> -->
                <div class="result-rating-message">Bagaimana pengalaman Anda bermain bersama kami?</div>
                <div class="stars">
                    <!-- <i class="fa-solid fa-star"></i>
                    <i class="fa-solid fa-star"></i>
                    <i class="fa-solid fa-star"></i>
                    <i class="fa-solid fa-star"></i>
                    <i class="fa-solid fa-star"></i> -->
                    <i v-for="(star,index) in stars" :key="index" 
                    @click="rate(index+1)"
                    :class="{active: index < selectedRating}"
                    class="fa-solid fa-star"></i>
                </div>
                <p class="star-message">{{ getMessage(selectedRating) }}</p>
                <button class="submit-btn" :class="{disabled : !selectedRating}" @click="submitRating()"></button>
            </div>
        </div>

        <!-- Coupon Page -->
        <div class="coupon-page" id="coupon-page" v-show="couponpage">
            <div class="coupon-details">
                <img class="coupon-details-img" :src="couponimage" alt="Coupon Details" width="296px" height="296px">
                <div class="coupon-details-data">
                    <div class="coupon-details-data-img">
                        <img src="Asset/quiz/Ellipse 23.png" alt="" width="48px">
                    </div>
                    <div class="coupon-details-data-bio">
                        <div>
                            <p>First Completion</p>
                            <p>Name</p>
                            <p>Phone</p>
                        </div>
                        <div>
                            <p> : </p>
                            <p> : </p>
                            <p> : </p>
                        </div>
                        <div>
                            <p>{{ coupondate == undefined ? "0" : coupondate }}</p>
                            <p>{{ couponusername == undefined ? "0" : couponusername }}</p>
                            <p>{{ formattedPhoneNumber == undefined ? "0" : formattedPhoneNumber }}</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="coupon-button">
                <p class="capture-btn">Screenshot dan simpan halaman ini untuk claim hadiahmu! </p>
                <button @click="backToHomeClick()" class="back-to-home-btn">Back to Home</button>
            </div>
        </div>

        <!-- API Error Page -->
        <div class="api-error-page" id="api-error-page" v-show="isAPIerror">
            <h1>ERROR {{ errorcode }}</h1>
            <p>Mohon maaf sedang ada gangguan sistem</p>
            <p>{{ errormessage}}</p>
            <button @click="windowsReloadAPIError()">Back To Home</button>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14"></script>

    <script>
        const vm = new Vue({
            el: '#app',
            data: {
                intropage: true, // bikin true nanti
                registpage: false,
                arintropage: false,
                arexperience: false,
                arstartquiz: false,
                targetfound: false,
                targetlost: false,
                markoclickme: false,
                resultpagesuccess: false,
                resultpagefailed: false,
                closeresultrating: false,
                couponpage: false,
                stars: [1,2,3,4,5],
                selectedRating: 0,

                // Marker
                markerSrc: "",

                // Marko GIF
                isIdleMarko: false,
                isRightMarko: false,
                isWrongMarko: false,

                // Register and Login Data
                userphonenumber: null,
                userfirstname: null,
                userlastname: null,
                userID: null,

                rearcamerabtnvisible : false,
                // Quiz Data
                loading: false,
                questions:[{
                            id: 1,
                            text: 'Ilmu apa yang mempelajari bagaimana mengoptimasi kegiatan manusia seperti produksi, pengelolaan dan ekonomi?',
                            answers: [{
                                    id: 1,
                                    text: 'Teknik Industri',
                                    isCorrect: true,
                                    isSelected: false
                                },
                                {
                                    id: 2,
                                    text: 'Teknik Lingkungan',
                                    isCorrect: false,
                                    isSelected: false
                                },
                                {
                                    id: 3,
                                    text: 'Teknik Sipil',
                                    isCorrect: false,
                                    isSelected: false
                                },
                                {
                                    id: 4,
                                    text: 'Teknik Kelautan',
                                    isCorrect: false,
                                    isSelected: false
                                }
                            ],
                        },
                        {
                            id: 2,
                            text: 'Yang bukan dari prospek karir lulusan teknik industri Petra?',
                            answers: [{
                                    id: 1,
                                    text: 'Entrepreneur',
                                    isCorrect: false,
                                    isSelected: false
                                },
                                {
                                    id: 2,
                                    text: 'Industrial Consultant',
                                    isCorrect: false,
                                    isSelected: false
                                },
                                {
                                    id: 3,
                                    text: 'Marketing Strategy',
                                    isCorrect: true,
                                    isSelected: false
                                },
                                {
                                    id: 4,
                                    text: 'Industrial Engineering',
                                    isCorrect: false,
                                    isSelected: false
                                }
                            ],
                        },

                    ],
                currentQuestion: 0,
                isLoadQuestion : false,
                selectedanswer: null,
                useranswers: [],
                isanswered: false,
                correctorincorrect: "",
                iscorrect: null,
                totalcoins: 0,
                isclaimreward: null,

                // Coupon Data
                couponusername : "",
                couponphonenumber : "",
                coupondate : "",
                couponimage: "",
                
                // API Error
                isAPIerror : false,
                errorcode : "",
                errormessage : "",
            },
            computed: {
                userFullName(){
                    return `${this.userfirstname} ${this.userlastname}`;
                },

                // Quiz Data
                question(){
                    return this.questions[this.currentQuestion].questions;
                },
                answers(){
                    return this.questions[this.currentQuestion].options;
                },

                // Coupon Formatted Phone Number
                formattedPhoneNumber(){
                    if(this.couponphonenumber >= 10){
                        const visiblePart = this.couponphonenumber.substring(0,2); // First 2 characters
                        const hiddenPart = "X".repeat(this.couponphonenumber.length - 6); // Middle X characters
                        const lastVisiblePart = this.couponphonenumber.substring(this.couponphonenumber.length - 4); // Last 4 characters
                        return `${visiblePart}${hiddenPart}${lastVisiblePart}`;
                    } else{
                        return this.couponphonenumber;
                    }
                }

            },
            mounted(){
                const token = localStorage.getItem('tokenmarkonah');
                const name = localStorage.getItem('namemarkonah');
                const phonenumber = localStorage.getItem('phonenumbermarkonah');
                const id = localStorage.getItem('IDmarkonah');
                if(token){
                    this.intropage = false;
                    this.arintropage = true;
                }

                axios.get("https://staging-ntmc-api.scanpedia.id/api/v1/markers/active", {
                    headers: {
                        "Authorization": `Bearer ${localStorage.getItem("tokenmarkonah")}`
                    }
                })
                .then((response)=>{
                    console.log(response);
                    this.markerSrc = response.data.data.asset_mind;
                    localStorage.setItem("markerURL", response.data.data.asset_mind);
                })
                .catch((error)=>{
                    console.log(error);
                })
            },
            methods:{
                tryNowClick(){
                    this.intropage = false;
                    this.registpage = true;
                },
                async submitSignUp(){
                    let formData = {
                        name: this.userFullName,
                        username: this.userphonenumber
                    }
                    await axios
                        .post("https://staging-ntmc-api.scanpedia.id/api/v1/login", formData)
                        .then((response) => {
                            console.log(response);
                            localStorage.setItem("tokenmarkonah", response.data.data.token);
                            localStorage.setItem("namemarkonah", response.data.data.user.name);
                            localStorage.setItem("phonenumbermarkonah", response.data.data.user.phone_number);
                            localStorage.setItem("IDmarkonah", response.data.data.user.id );
                            this.userID = response.data.data.user.id;
                            this.registpage = false;
                            // this.arintropage = true;    
                            window.location.reload(true);
                        })
                        .catch((error)=>{
                            console.log(error);
                            this.isAPIerror = true;
                            this.registpage = false;
                            console.log(error.response.data.code);
                            console.log(error.response.data.message);
                            this.errorcode = error.response.data.code;
                            this.errormessage = error.response.data.message;
                        })
                },
                signUpClick(){
                    this.registpage = false;
                    this.arintropage = true;
                },
                activateRearCameraClick(){
                    this.arintropage = false;
                    this.arexperience = true;
                    

                },
                clickMeStartTheQuiz(){
                    this.markoclickme = true;
                    this.arstartquiz = false;
                    this.loading = true;
                    axios.get("https://staging-ntmc-api.scanpedia.id/api/v1/questions/task", {
                        headers: {
                            "Authorization": `Bearer ${localStorage.getItem("tokenmarkonah")}`
                        }
                    })
                    .then((response) =>{
                        console.log(response);
                        this.questions = response.data.data;
                        this.isLoadQuestion = true;
                        this.loading = false;
                        // if (this.targetfound){
                        //     this.isIdleMarko = false;
                        //     this.isRightMarko = false;
                        //     this.isWrongMarko = false;
                        // }
                        // else{
                        //     this.isIdleMarko = true;
                        //     this.isRightMarko = false;
                        //     this.isWrongMarko = false;
                        // }
                        console.log(this.questions.length);
                        if(this.questions.length < 10){
                            alert("Sistem sedang dalam perbaikan. Silakan kembali di lain waktu");
                            this.arintropage = true;
                            this.markoclickme = false;
                            this.arexperience = false;
                        }
                    })
                    .catch((error)=>{
                        console.log(error);
                        this.isAPIerror = true;
                        this.arexperience = false;
                        console.log(error.response.data.code);
                        console.log(error.response.data.message);
                        this.errorcode = error.response.data.code;
                        this.errormessage = error.response.data.message;
                    })
                },
                checkAnswer(answer){
                    this.selectedanswer = answer;
                    this.useranswers[this.currentQuestion] = answer;
                    this.isanswered = true;
                    
                    if(answer.option_key == this.questions[this.currentQuestion].answer_key){
                        // alert("Your answer is correct");
                        this.totalcoins = this.totalcoins + 10;
                        this.correctorincorrect = "Benar!";
                        this.iscorrect = true;
                        console.log(this.totalcoins);
                        document.getElementById("audio-yes").play();
                        document.getElementById("audio-yes").muted = false;

                        //JAWABAN BENAR RUBAH ANIMASI
                        if(this.targetfound){
                            this.isIdleMarko = false;
                            this.isRightMarko = false;
                            this.isWrongMarko = false;
                        }
                        else if (this.targetlost){
                            this.isIdleMarko = false;
                            this.isRightMarko = true;
                            this.isWrongMarko = false;
                        }
                        else{
                            this.isIdleMarko = false;
                            this.isRightMarko = true;
                            this.isWrongMarko = false;
                        }

                        
                        
                        document.getElementById("ntmc-1").setAttribute("animation-mixer","clip: Right*");
                        document.getElementById("ntmc-2").setAttribute("animation-mixer","clip: Right*");
                        document.getElementById("ntmc-3").setAttribute("animation-mixer","clip: Right*");
                        document.getElementById("ntmc-4").setAttribute("animation-mixer","clip: Right*");
                        document.getElementById("ntmc-5").setAttribute("animation-mixer","clip: Right*");

                        
                    }
                    else{
                        // alert("Your answer is incorrect!");
                        this.correctorincorrect = "Salah!"
                        this.iscorrect = false;
                        this.totalcoins = this.totalcoins;
                        document.getElementById("audio-no").play();
                        document.getElementById("audio-no").muted = false;

                        // JAWABAN SALAH RUBAH ANIMASI

                        if(this.targetfound){
                            this.isIdleMarko = false;
                            this.isRightMarko = false;
                            this.isWrongMarko = false;
                        }
                        else if (this.targetlost){
                            this.isIdleMarko = false;
                            this.isRightMarko = false;
                            this.isWrongMarko = true;
                        }
                        else{
                            this.isIdleMarko = false;
                            this.isRightMarko = false;
                            this.isWrongMarko = true;
                        }

                        
                    
                        document.getElementById("ntmc-1").setAttribute("animation-mixer","clip: Wrong*");
                        document.getElementById("ntmc-2").setAttribute("animation-mixer","clip: Wrong*");
                        document.getElementById("ntmc-3").setAttribute("animation-mixer","clip: Wrong*");
                        document.getElementById("ntmc-4").setAttribute("animation-mixer","clip: Wrong*");
                        document.getElementById("ntmc-5").setAttribute("animation-mixer","clip: Wrong*");
                        
                    }
                },

                answerClass(answer){
                    if(this.selectedanswer == answer) {
                        if(answer.option_key == this.questions[this.currentQuestion].answer_key){
                            return 'correct'
                        } else {
                            return 'wrong'
                        }
                    }
                    else if (this.isanswered == true) {
                        return 'answered';
                    }
                },

                nextQuestion: function (){
                    this.selectedanswer = null;
                    this.currentQuestion++;
                    this.isanswered = false;
                    this.correctorincorrect = "";
                    this.iscorrect = null;

                    // QUIZ sedang IDLE RUBAH ANIMASI
                    if(this.targetfound){
                        this.isIdleMarko = false;
                        this.isRightMarko = false;
                        this.isWrongMarko = false;
                        }
                    else{
                        this.isIdleMarko = true;
                        this.isRightMarko = false;
                        this.isWrongMarko = false;
                    }

                    document.getElementById("ntmc-1").setAttribute("animation-mixer","clip: NlaTrack*");
                    document.getElementById("ntmc-2").setAttribute("animation-mixer","clip: NlaTrack*");
                    document.getElementById("ntmc-3").setAttribute("animation-mixer","clip: NlaTrack*");
                    document.getElementById("ntmc-4").setAttribute("animation-mixer","clip: NlaTrack*");
                    document.getElementById("ntmc-5").setAttribute("animation-mixer","clip: NlaTrack*");
                    
                    if(this.currentQuestion >= this.questions.length){
                        for(let i = 0; i < this.useranswers.length; i++ ){
                            this.questions[i].answer_user = this.useranswers[i].option_key;
                        }
                        axios.post("https://staging-ntmc-api.scanpedia.id/api/v1/questions/submit", {
                            score : this.totalcoins,
                            questions: this.questions
                        }, {
                            headers: {
                                        "Authorization": `Bearer ${localStorage.getItem("tokenmarkonah")}`
                                    }
                        })
                        .then((response) =>{
                            console.log(response);
                            this.isclaimreward = response.data.data.claim_reward;
                            if(this.isclaimreward){
                                this.resultpagesuccess = true;
                                this.markoclickme = false;
                                this.arexperience = false;
                            }
                            else{
                                this.resultpagefailed = true;
                                this.markoclickme = false;
                                this.arexperience = false;
                            }
                        })
                        .catch((error)=>{
                            console.log(error);
                            this.isAPIerror = true;
                            this.arexperience = false;
                            console.log(error.response.data.code);
                            console.log(error.response.data.message);
                            this.errorcode = error.response.data.code;
                            this.errormessage = error.response.data.message;
                        })
                        alert("Quiz is finished");
                        this.currentQuestion = 0;
                    }
                },


                rate(rating){
                    this.selectedRating = rating;
                },
                getMessage(rating){
                    switch(rating){
                        case 1:
                            return 'Very Dissatisified';
                        case 2:
                            return 'Dissatisfied';
                        case 3:
                            return 'Neutral';
                        case 4:
                            return 'Satisfied';
                        case 5:
                            return 'Very Satisfied';
                        default:
                            return '';
                    }
                },
                submitRating(){
                    axios.post("https://staging-ntmc-api.scanpedia.id/api/v1/rating", {
                            rating: this.selectedRating
                        }, {
                            headers: {
                                        "Authorization": `Bearer ${localStorage.getItem("tokenmarkonah")}`
                                    }
                        })
                        .then((response) => {
                            console.log(response);
                            alert("Rating has been submitted!");
                            this.closeresultrating = true;
                        })
                        .catch((error) =>{
                            console.log(error);
                            alert("Error");
                        })
                    
                },
                closeRatingButtonClick(){
                    this.closeresultrating = true;
                },
                claimRewardsClick(){
                    this.resultpagesuccess = false;
                    this.couponpage = true;

                    axios.get(`https://staging-ntmc-api.scanpedia.id/api/v1/coupons/user/${localStorage.getItem("IDmarkonah")}/reward`, {
                        headers: {
                            "Authorization": `Bearer ${localStorage.getItem("tokenmarkonah")}`
                        }
                    })
                    .then((response) =>{
                        console.log(response);
                        this.couponusername = response.data.data.user.name;
                        this.couponphonenumber = response.data.data.user.phone_number;
                        this.coupondate = response.data.data.user.first_submit_question;
                        this.couponimage = response.data.data.coupon.image;
                    })
                    .catch((error)=>{
                        console.log(error);
                        this.isAPIerror = true;
                        this.couponpage = false;
                        console.log(error.response.data.code);
                        console.log(error.response.data.message);
                        this.errorcode = error.response.data.code;
                        this.errormessage = error.response.data.message;
                    })
                },


                windowsReload(){
                    window.location.reload(true);
                },

                windowsReloadAPIError(){
                    window.location.reload(true);
                    this.isAPIerror = false;
                    localStorage.removeItem("tokenmarkonah");
                    localStorage.removeItem("namemarkonah");
                    localStorage.removeItem("phonenumbermarkonah");
                    localStorage.removeItem("IDmarkonah");
                },

                backToHomeClick(){
                    window.location.reload(true);
                    localStorage.removeItem("tokenmarkonah");
                    localStorage.removeItem("namemarkonah");
                    localStorage.removeItem("phonenumbermarkonah");
                    localStorage.removeItem("IDmarkonah");

                }
            }
        })
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function(){
            const sceneEl = document.querySelector('a-scene');
            const arSystem = sceneEl.systems["mindar-image-system"];
            const rearCameraBtn = document.querySelector(".rear-camera-btn");
            const targetMarkonah1 = document.getElementById("target-markonah-1");
            const targetMarkonah2 = document.getElementById("target-markonah-2");
            const targetMarkonah3 = document.getElementById("target-markonah-3");
            const targetMarkonah4 = document.getElementById("target-markonah-4");
            const targetMarkonah5 = document.getElementById("target-markonah-5");
            
            const markerURL = localStorage.getItem("markerURL");
            if(markerURL){
                sceneEl.setAttribute("mindar-image", `imageTargetSrc: ${markerURL}`);
                console.log("There is a marker");

            } else {
                setTimeout(function () {
                    const markerURL = localStorage.getItem("markerURL");
                    if(markerURL){
                        sceneEl.setAttribute("mindar-image", `imageTargetSrc: ${markerURL}`);
                        console.log("There is a marker after");
                    }
                }, 2000);
            }

            var alertShown = false;

            function checkMarkerURLChange(){
                var currentMarkerURL = localStorage.getItem('markerURL');
                var storedMarkerURL = sessionStorage.getItem('storedMarkerURL');
                // console.log(currentMarkerURL);
                // console.log(storedMarkerURL);

                if(currentMarkerURL !== storedMarkerURL && storedMarkerURL !== "null"){
                    if(!alertShown){
                        alertShown = true;
                        alert("AR Marker telah diganti. Halaman ini akan dimuat kembali untuk menggunakan AR Marker yang baru.");
                        window.location.reload(true);
                    }
                }
                
            }
            
            setInterval(checkMarkerURLChange, 2000);
            // checkMarkerURLChange();

            var initialMarkerURL = localStorage.getItem('markerURL');
            sessionStorage.setItem('storedMarkerURL', initialMarkerURL);
            // sceneEl.setAttribute("mindar-image", "imageTargetSrc : image/targets4.mind");
            // alert(localStorage.getItem("markerURL"));
            
            // Audio
            const audioHi = document.getElementById("audio-hi");
            const audioYes = document.getElementById("audio-yes");
            const audioNo = document.getElementById("audio-no");


            rearCameraBtn.addEventListener("click", () =>{
                arSystem.start();
                audioHi.play();
                audioHi.muted = true;
                audioYes.play();
                audioYes.muted = true;
                audioNo.play();
                audioNo.muted = true;
            });
            
            targetMarkonah1.addEventListener("targetFound", event =>{
                // Video Appears
                // markoIdle.setAttribute('visible', true);
                // markoRight.setAttribute('visible', false);
                // markoWrong.setAttribute('visible', false);
                // markoIdleVideo.play();
                // markoRightVideo.play();
                // markoWrongVideo.play();
                vm.targetfound = true;
                vm.targetlost = false;

                vm.isIdleMarko = false;
                vm.isRightMarko = false;
                vm.isWrongMarko = false;
                if(vm.markoclickme){
                    vm.arstartquiz = false;
                }
                else{
                    vm.arstartquiz = true;
                    // audioHi.pause();
                    audioHi.play();
                    audioHi.muted = false;
                }

            });

            targetMarkonah2.addEventListener("targetFound", event =>{
                // Video Appears
                // markoIdle.setAttribute('visible', true);
                // markoRight.setAttribute('visible', false);
                // markoWrong.setAttribute('visible', false);
                // markoIdleVideo.play();
                // markoRightVideo.play();
                // markoWrongVideo.play();
                vm.targetfound = true;
                vm.targetlost = false;

                vm.isIdleMarko = false;
                vm.isRightMarko = false;
                vm.isWrongMarko = false;
                if(vm.markoclickme){
                    vm.arstartquiz = false;
                }
                else{
                    vm.arstartquiz = true;
                    // audioHi.pause();
                    audioHi.play();
                    audioHi.muted = false;
                }
            });

            targetMarkonah3.addEventListener("targetFound", event =>{
                // Video Appears
                // markoIdle.setAttribute('visible', true);
                // markoRight.setAttribute('visible', false);
                // markoWrong.setAttribute('visible', false);
                // markoIdleVideo.play();
                // markoRightVideo.play();
                // markoWrongVideo.play();
                vm.targetfound = true;
                vm.targetlost = false;

                vm.isIdleMarko = false;
                vm.isRightMarko = false;
                vm.isWrongMarko = false;
                if(vm.markoclickme){
                    vm.arstartquiz = false;
                }
                else{
                    vm.arstartquiz = true;
                    // audioHi.pause();
                    audioHi.play();
                    audioHi.muted = false;
                }
            
            });

            targetMarkonah4.addEventListener("targetFound", event =>{
                // Video Appears
                // markoIdle.setAttribute('visible', true);
                // markoRight.setAttribute('visible', false);
                // markoWrong.setAttribute('visible', false);
                // markoIdleVideo.play();
                // markoRightVideo.play();
                // markoWrongVideo.play();
                vm.targetfound = true;
                vm.targetlost = false;

                vm.isIdleMarko = false;
                vm.isRightMarko = false;
                vm.isWrongMarko = false;
                if(vm.markoclickme){
                    vm.arstartquiz = false;
                }
                else{
                    vm.arstartquiz = true;
                    // audioHi.pause();
                    audioHi.play();
                    audioHi.muted = false;
                }

            });

            targetMarkonah5.addEventListener("targetFound", event =>{
                // Video Appears
                // markoIdle.setAttribute('visible', true);
                // markoRight.setAttribute('visible', false);
                // markoWrong.setAttribute('visible', false);
                // markoIdleVideo.play();
                // markoRightVideo.play();
                // markoWrongVideo.play();
                vm.targetfound = true;
                vm.targetlost = false;

                vm.isIdleMarko = false;
                vm.isRightMarko = false;
                vm.isWrongMarko = false;
                if(vm.markoclickme){
                    vm.arstartquiz = false;
                }
                else{
                    vm.arstartquiz = true;
                    // audioHi.pause();
                    audioHi.play();
                    audioHi.muted = false;
                }

            });

            targetMarkonah1.addEventListener("targetLost", event => {
                vm.arstartquiz = false;
                vm.targetfound = false;
                vm.targetlost = true;

                if(vm.markoclickme && !vm.isanswered){
                    console.log("Marko is clicked")
                    vm.isIdleMarko = true;
                    vm.isRightMarko = false;
                    vm.isWrongMarko = false;
                }
                else if(vm.isanswered && vm.iscorrect){
                    console.log("Answer is correct")
                    vm.isIdleMarko = false;
                    vm.isRightMarko = true;
                    vm.isWrongMarko = false;
                }
                else if(vm.isanswered && !vm.iscorrect){
                    console.log("Answer is incorrect")
                    vm.isIdleMarko = false;
                    vm.isRightMarko = false;
                    vm.isWrongMarko = true;
                }
                else {
                    vm.isIdleMarko = false;
                    vm.isRightMarko = false;
                    vm.isWrongMarko = false;
                }
            });
            targetMarkonah2.addEventListener("targetLost", event => {
                vm.arstartquiz = false;
                vm.targetfound = false;
                vm.targetlost = true;

                if(vm.markoclickme && !vm.isanswered){
                    console.log("Marko is clicked")
                    vm.isIdleMarko = true;
                    vm.isRightMarko = false;
                    vm.isWrongMarko = false;
                }
                else if(vm.isanswered && vm.iscorrect){
                    console.log("Answer is correct")
                    vm.isIdleMarko = false;
                    vm.isRightMarko = true;
                    vm.isWrongMarko = false;
                }
                else if(vm.isanswered && !vm.iscorrect){
                    console.log("Answer is incorrect")
                    vm.isIdleMarko = false;
                    vm.isRightMarko = false;
                    vm.isWrongMarko = true;
                }
                else {
                    vm.isIdleMarko = false;
                    vm.isRightMarko = false;
                    vm.isWrongMarko = false;
                }

            });
            targetMarkonah3.addEventListener("targetLost", event => {
                vm.arstartquiz = false;
                vm.targetfound = false;
                vm.targetlost = true;
                if(vm.markoclickme && !vm.isanswered){
                    console.log("Marko is clicked")
                    vm.isIdleMarko = true;
                    vm.isRightMarko = false;
                    vm.isWrongMarko = false;
                }
                else if(vm.isanswered && vm.iscorrect){
                    console.log("Answer is correct")
                    vm.isIdleMarko = false;
                    vm.isRightMarko = true;
                    vm.isWrongMarko = false;
                }
                else if(vm.isanswered && !vm.iscorrect){
                    console.log("Answer is incorrect")
                    vm.isIdleMarko = false;
                    vm.isRightMarko = false;
                    vm.isWrongMarko = true;
                }
                else {
                    vm.isIdleMarko = false;
                    vm.isRightMarko = false;
                    vm.isWrongMarko = false;
                }

            });
            targetMarkonah4.addEventListener("targetLost", event => {
                vm.arstartquiz = false;
                vm.targetfound = false;
                vm.targetlost = true;
                if(vm.markoclickme && !vm.isanswered){
                    console.log("Marko is clicked")
                    vm.isIdleMarko = true;
                    vm.isRightMarko = false;
                    vm.isWrongMarko = false;
                }
                else if(vm.isanswered && vm.iscorrect){
                    console.log("Answer is correct")
                    vm.isIdleMarko = false;
                    vm.isRightMarko = true;
                    vm.isWrongMarko = false;
                }
                else if(vm.isanswered && !vm.iscorrect){
                    console.log("Answer is incorrect")
                    vm.isIdleMarko = false;
                    vm.isRightMarko = false;
                    vm.isWrongMarko = true;
                }
                else {
                    vm.isIdleMarko = false;
                    vm.isRightMarko = false;
                    vm.isWrongMarko = false;
                }

            });
            targetMarkonah5.addEventListener("targetLost", event => {
                vm.arstartquiz = false;
                vm.targetfound = false;
                vm.targetlost = true;
                if(vm.markoclickme && !vm.isanswered){
                    console.log("Marko is clicked")
                    vm.isIdleMarko = true;
                    vm.isRightMarko = false;
                    vm.isWrongMarko = false;
                }
                else if(vm.isanswered && vm.iscorrect){
                    console.log("Answer is correct")
                    vm.isIdleMarko = false;
                    vm.isRightMarko = true;
                    vm.isWrongMarko = false;
                }
                else if(vm.isanswered && !vm.iscorrect){
                    console.log("Answer is incorrect")
                    vm.isIdleMarko = false;
                    vm.isRightMarko = false;
                    vm.isWrongMarko = true;
                }
                else {
                    vm.isIdleMarko = false;
                    vm.isRightMarko = false;
                    vm.isWrongMarko = false;
                }

            });
            
            // arReady event triggered when ready
            sceneEl.addEventListener("arReady", (event) => {
                // console.log("MindAR is ready");
                // console.log(sceneEl);
                console.log("AR System is ready");
            });
            

            // arError event triggered when something went wrong. Mostly browser compatbility issue
            sceneEl.addEventListener("arError", (event) => {
                // console.log("MindAR failed to start")
            });

            function playAudioHi(){
                audioHi.play();
            }
            

        })
    </script>

    <script>
        // Get the text input
        const firstnameinput = document.getElementById('first-name');

        // Add keypress event listener
        firstnameinput.addEventListener('keypress', function(event){
            
            // Get the key 
            let key = event.key;
            
            let regex = new RegExp("^[a-zA-Z ]+$");
            
            // Check if key is in the reg exp
            if(!regex.test(key)){
                
                // Restrict the special characters
                event.preventDefault();  
                return false;
            }
        });

        // Get the text input
        const lastnameinput = document.getElementById('last-name');

        // Add keypress event listener
        lastnameinput.addEventListener('keypress', function(event){
            
            // Get the key 
            let key = event.key;
            
            let regex = new RegExp("^[a-zA-Z ]+$");
            
            // Check if key is in the reg exp
            if(!regex.test(key)){
                
                // Restrict the special characters
                event.preventDefault();  
                return false;
            }
        });

        // Get the text input
        const registphoneinput = document.getElementById('regist-phone');

        // Add keypress event listener
        registphoneinput.addEventListener('keypress', function(event){
            
            // Get the key 
            let key = event.key;
            
            let regex = new RegExp("^[0-9]+$");
            
            // Check if key is in the reg exp
            if(!regex.test(key)){
                
                // Restrict the special characters
                event.preventDefault();  
                return false;
            }
        });

        window.onload = function (){
            console.log("Windows is loaded");
            setTimeout(function () {
                vm.rearcamerabtnvisible = true;
            }, 5000); // 2000 milliseconds = 2 seconds 
        };

        
    </script>
</body>
</html>